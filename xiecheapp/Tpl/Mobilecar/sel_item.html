<!DOCTYPE html>
<html>
  <head>
    <title>携车网-上门保养</title>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="telephone=no" name="format-detection">
    <link href="__PUBLIC__/mobile/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="__PUBLIC__/mobile/js/libs/jquery/jquery-1.9.1.js"></script>
    <script src="__PUBLIC__/mobile/bootstrap/js/bootstrap.min.js"></script>
    <link href="__PUBLIC__/mobile/css/index2.css" rel="stylesheet">
    <style>
    .caret{margin-left: 0;}
    </style>
  </head>

  <body>
    
    <div class="pagetop">
      <div class="reindex" id="reindex">&nbsp;</div>
      <div class="thispage">上门保养</div>
    </div>

    <div class="container huise">
      <div class="row smenu">
        <div class="col-xs-4 smenuli smrbg current"><a href="__APP__/mobilecar/sel_item">立即下单</a></div>
        <div class="col-xs-4 smenuli smrbg"><a href="__APP__/mobilecar/carservice_des">服务介绍</a></div>
        <div class="col-xs-4 smenuli"><a href="__APP__/mobilecar/commentList">车主评价</a></div>
      </div>

      <div class="carname">{$brand_name}&nbsp;<span class="carxh">{$model_name}</span></div>
      <div class="carprice">价格:<span class="pricenum"><b id="amount">456</b>元</span></div>

      <div class="smenu2">
        <div class="col-xs-6 sm2rbg current smallby">小保养</div>
        <div class="col-xs-6 bigby">大保养</div>
      </div>

      <div class="smianfei">
        <table width="100%">
          <tbody>
            <tr>
              <td width="23" align="center"><img src="__PUBLIC__/mobile/images/gou.png" width="12" alt=""></td>
              <td style="position:relative;"><a href="__APP__/mobilecar/check_report" style="color:#494b4a;"><u>38项车辆检测(免费)&nbsp;<img width="14" alt="" src="/Public/mobile/images/wenhao.png" style="position:absolute; top:2px;"/></u></a></td>
              <td width="23" align="center"><img src="__PUBLIC__/mobile/images/gou.png" width="12" alt=""></td>
              <td>300万责任险(免费)</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="xiangmu" style="font-size:12px;">
        <div class="xmone">
          <table width="100%">
            <tbody>
              <tr align="center">
                <td width="30"><img class="gou xby" src="__PUBLIC__/mobile/images/gou2.png" width="12" alt=""></td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="65">机油</td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td>
                  <select name="item_id_0" id="item_id_0" class="item_id">
                    <optgroup label="全合成油">
                      <foreach name="item_sets" item="set1" key="k" >
                        <eq name="set1.type" value="3">
                          <option data-oil-1-id="{$set1['oil_1']}" data-oil-2-id="{$set1['oil_2']}" data-oil-1-num="{$set1['oil_1_num']}" data-oil-2-num="{$set1['oil_2_num']}" id="CheckboxGroup0_{$set1['id']}" value="{$set1['id']}" data-price="{$set1['price']}">{$set1['name']}&nbsp;{$car_style['norms']}（￥{$set1['price']}）</option>
                        </eq>
                      </foreach>
                    </optgroup>
                    <optgroup label="半合成油">
                      <foreach name="item_sets" item="set1" key="k" >
                        <eq name="set1.type" value="2">
                          <option data-oil-1-id="{$set1['oil_1']}" data-oil-2-id="{$set1['oil_2']}" data-oil-1-num="{$set1['oil_1_num']}" data-oil-2-num="{$set1['oil_2_num']}" id="CheckboxGroup0_{$set1['id']}" value="{$set1['id']}" data-price="{$set1['price']}">{$set1['name']}&nbsp;{$car_style['norms']}（￥{$set1['price']}）</option>
                        </eq>
                      </foreach>
                    </optgroup>
                    <optgroup label="矿物油">
                      <foreach name="item_sets" item="set1" key="k" >
                        <eq name="set1.type" value="1">
                          <option data-oil-1-id="{$set1['oil_1']}" data-oil-2-id="{$set1['oil_2']}" data-oil-1-num="{$set1['oil_1_num']}" data-oil-2-num="{$set1['oil_2_num']}" id="CheckboxGroup0_{$set1['id']}" value="{$set1['id']}" data-price="{$set1['price']}">{$set1['name']}&nbsp;{$car_style['norms']}（￥{$set1['price']}）</option>
                        </eq>
                      </foreach>
                    </optgroup>
                    <optgroup label="其他">
                    <option id="CheckboxGroup0_-1" value="0" data-price="0">自备配件<strong>（￥0）</strong></option>
                    </optgroup>
                  </select>
                  <input type="hidden" id="item_price_0" class="item_price" value="{$item_sets['0']['price']}" data-id="{$item_sets['0']['id']}">
                </td>
                <!-- <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="20" align="center"><span class="caret"></span></td> -->
              </tr>
            </tbody>
          </table>
        </div>
        <div class="xmone">
          <table width="100%">
            <tbody>
              <tr align="center">
                <td width="30"><img class="gou xby" src="__PUBLIC__/mobile/images/gou2.png" width="12" alt=""></td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="65">机滤</td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td>
                  <select name="item_id_1" id="item_id_1" class="item_id">
                    <foreach name="item_set[1]" item="value">
                    <option id="CheckboxGroup1_{$value['id']}" value="{$value['id']}" data-price="{$value['price']}" style="padding-left:20px;">{$value['name']}<strong>（￥{$value['price']}）</strong></option>
                    </foreach>
                    <option id="CheckboxGroup1_-1" value="0" data-price="0">自备配件<strong>（￥0）</strong></option>
                  </select>
                  <input type="hidden" id="item_price_1" class="item_price" value="{$item_set['1']['0']['price']}" data-id="{$item_set['1']['0']['id']}">
                </td>
                <!-- <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="20" align="center"><span class="caret"></span></td>  -->
              </tr>
            </tbody>
          </table>
        </div>
        <div class="xmone">
          <table width="100%">
            <tbody>
              <tr align="center">
                <td width="30"><img class="gou dby" src="__PUBLIC__/mobile/images/gou3.png" width="12" alt=""></td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="65">空气滤清器</td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td>
                  <select name="item_id_2" id="item_id_2" class="item_id">
                    <foreach name="item_set[2]" item="value">
                    <option id="CheckboxGroup2_{$value['id']}" value="{$value['id']}" data-price="{$value['price']}" style="padding-left:20px;">{$value['name']}<strong>（￥{$value['price']}）</strong></option>
                    </foreach>
                    <option id="CheckboxGroup2_-1" value="0" data-price="0">自备配件<strong>（￥0）</strong></option>
                  </select>
                  <input type="hidden" id="item_price_2" class="item_price" value="{$item_set['2']['0']['price']}" data-id="{$item_set['2']['0']['id']}">
                </td>
                <!-- <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="21" align="center"><span class="caret"></span></td> -->
              </tr>
            </tbody>
          </table>
        </div>
        <div class="xmone">
          <table width="100%">
            <tbody>
              <tr align="center">
                <td width="30"><img class="gou dby" src="__PUBLIC__/mobile/images/gou3.png" width="12" alt=""></td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="65">空调滤清器</td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td>
                  <select name="item_id_3" id="item_id_3" class="item_id">
                    <foreach name="item_set[3]" item="value">
                    <option id="CheckboxGroup3_{$value['id']}" value="{$value['id']}" data-price="{$value['price']}" style="padding-left:20px;">{$value['name']}<strong>（￥{$value['price']}）</strong></option>
                    </foreach>
                    <option id="CheckboxGroup3_-1" value="0" data-price="0">自备配件<strong>（￥0）</strong></option>
                  </select>
                  <input type="hidden" id="item_price_3" class="item_price" value="{$item_set['3']['0']['price']}" data-id="{$item_set['3']['0']['id']}">
                </td>
                <!-- <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td width="20" align="center"><span class="caret"></span></td> -->
              </tr>
            </tbody>
          </table>
        </div>
        <div class="xmone">
          <table width="100%">
            <tbody>
              <tr align="center">
                <td width="30"><img class="onlyfuwu" src="__PUBLIC__/mobile/images/gou3.png" width="12" alt=""></td>
                <td width="1"><img src="__PUBLIC__/mobile/images/line.png" alt=""></td>
                <td>已有配件,仅购买上门服务</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="xmone">
          <table width="100%">
            <tbody>
              <tr align="center">
                <td>服务费 ￥{$service_cost}</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div>支持现金支付-在线支付</div>
        <form method="post" action="__APP__/mobilecar/order" name="subForm" id="subForm" >
              <input type="hidden" name="oil_1_id" value="{$item_sets['0']['oil_1']}" />
              <input type="hidden" name="oil_1_num" value="{$item_sets['0']['oil_1_num']}" />
              <input type="hidden" name="oil_2_id" value="{$item_sets['0']['oil_2']}" />
              <input type="hidden" name="oil_2_num" value="{$item_sets['0']['oil_2_num']}" />
              <input type="hidden" name="CheckboxGroup0_res" id="CheckboxGroup0_res" value="<empty name="item_sets['0']['id']">-1<else />{$item_sets['0']['id']}</empty>">
              <input type="hidden" name="CheckboxGroup1_res" id="CheckboxGroup1_res" value="<empty name="item_set['1']['0']['id']">-1<else />{$item_set['1']['0']['id']}</empty>">
              <input type="hidden" name="CheckboxGroup2_res" id="CheckboxGroup2_res" value="0">
              <input type="hidden" name="CheckboxGroup3_res" id="CheckboxGroup3_res" value="0">
        </form>
        <button class="btn btnyd" onclick="document.getElementById('subForm').submit();">立即预定</button>

      </div>

    </div>

    <script>
      $(function(){

        //返回上一页
        $("#reindex").click(function(){
          <empty name="pa_id">
            window.location.href='/mobilecar-carservice';
          <else />
            window.location.href='/mobilecar-carservice-pa_id-{$pa_id}';
          </empty>
        });

        //计算价格

        /**15-7-1以前
		var amout = 0;
		**/
		var amount = {$item_sets['0']['price'] + $item_set['1']['0']['price'] + $service_cost};

        //$("#amount").text(amount);

        var old_price = 0, price = 0;
        
        $("img.gou").parent().click(function(){

          var res = $(this).parent().find(".item_id").val();

            //item_id_0机油 item_id_1机滤 item_id_2空气滤 item_id_3空调滤
          var _id = $(this).parent().find(".item_id").attr("id");
          var id = $(this).parent().find(".item_id").find('option:selected').attr("id");
          
          id = id.split("_");
          id = id['1'];
          
          _id = _id.split("_");
          _id = _id['2'];

            //未选
          if($(this).find("img.gou").attr("src") == "__PUBLIC__/mobile/images/gou3.png"){
              $("#CheckboxGroup"+_id+"_res").val(id);


              var price = $(this).parent().parent().find(".item_price").val();
              amount += Number(price);

              $(this).find("img.gou").attr("src", "__PUBLIC__/mobile/images/gou2.png");

          }else{
              $("#CheckboxGroup"+_id+"_res").val(0);

              var price = $(this).parent().parent().find(".item_price").val();
              amount -= Number(price);

              /***2015-6-30***/
              if(amount < 0){
                  amount = 0;
              }

              $(this).find("img.gou").attr("src", "__PUBLIC__/mobile/images/gou3.png");
          }

          //大小保养样式
          if($("img.gou:eq(0)").attr("src") == "__PUBLIC__/mobile/images/gou2.png"&&$("img.gou:eq(1)").attr("src") == "__PUBLIC__/mobile/images/gou2.png"){
            if($("img.gou:eq(2)").attr("src") == "__PUBLIC__/mobile/images/gou3.png"&&$("img.gou:eq(3)").attr("src") == "__PUBLIC__/mobile/images/gou3.png"){
              $(".smenu2 div:eq(0)").addClass("current").siblings().removeClass("current");
            }else if($("img.gou:eq(2)").attr("src") == "__PUBLIC__/mobile/images/gou2.png"&&$("img.gou:eq(3)").attr("src") == "__PUBLIC__/mobile/images/gou2.png"){
              $(".smenu2 div:eq(1)").addClass("current").siblings().removeClass("current");
            }else{
              $(".smenu2 div").removeClass("current");
            }
          }else{
            $(".smenu2 div").removeClass("current");
          }

          $("#amount").text(amount);
          $(".onlyfuwu").attr("src", "__PUBLIC__/mobile/images/gou3.png");

        });

        //小保养
        $(".smenu2 div.smallby").click(function(){
		  $(this).addClass("current").siblings().removeClass("current");
          $("img.gou.xby").attr("src","__PUBLIC__/mobile/images/gou2.png");
          $("img.gou.dby").attr("src","__PUBLIC__/mobile/images/gou3.png");
          $("img.onlyfuwu").attr("src","__PUBLIC__/mobile/images/gou3.png");

          var $oil_1_id = $("#item_id_0").find("option:selected").attr('data-oil-1-id'); 
          var $oil_1_num = $("#item_id_0").find("option:selected").attr('data-oil-1-num');
          var $oil_2_id = $("#item_id_0").find("option:selected").attr('data-oil-2-id');
          var $oil_2_num = $("#item_id_0").find("option:selected").attr('data-oil-2-num');
          $('input[name=oil_1_id]').val($oil_1_id);
          $('input[name=oil_2_id]').val($oil_2_id);
          $('input[name=oil_1_num]').val($oil_1_num);
          $('input[name=oil_2_num]').val($oil_2_num);

          var old0_price  = $('#item_id_0').find("option:selected").attr("data-price");
          var old1_price  = $('#item_id_1').find("option:selected").attr("data-price");
          var old2_price  = $('#item_id_2').find("option:selected").attr("data-price");
          var old3_price  = $('#item_id_3').find("option:selected").attr("data-price");
          var old0_id = $('#item_price_0').attr('data-id');
          var old1_id = $('#item_price_1').attr('data-id');
          var old2_id = $('#item_price_2').attr('data-id');
          var old3_id = $('#item_price_3').attr('data-id');


           $("#item_price_0").val(old0_price);
           $("#item_price_1").val(old1_price);
           $("#item_price_2").val(old2_price);
           $("#item_price_3").val(old3_price);

          $("#CheckboxGroup0_res").val(old0_id);
          $("#CheckboxGroup1_res").val(old1_id);
          $("#CheckboxGroup2_res").val(old2_id);
          $("#CheckboxGroup3_res").val(old3_id);

          var price0 = $('option:selected').eq(0).attr('data-price');
          var price1 = $('option:selected').eq(1).attr('data-price');

            amount = Number(price0)+Number(price1)+{$service_cost};

          $("#amount").text(amount);

        });
        //大保养
        $(".smenu2 div.bigby").click(function(){
          $(this).addClass("current").siblings().removeClass("current");
          $("img.gou.xby").attr("src","__PUBLIC__/mobile/images/gou2.png");
          $("img.gou.dby").attr("src","__PUBLIC__/mobile/images/gou2.png");
          $("img.onlyfuwu").attr("src","__PUBLIC__/mobile/images/gou3.png");

          var $oil_1_id = $("#item_id_0").find("option:selected").attr('data-oil-1-id'); 
          var $oil_1_num = $("#item_id_0").find("option:selected").attr('data-oil-1-num');
          var $oil_2_id = $("#item_id_0").find("option:selected").attr('data-oil-2-id');
          var $oil_2_num = $("#item_id_0").find("option:selected").attr('data-oil-2-num');
          $('input[name=oil_1_id]').val($oil_1_id);
          $('input[name=oil_2_id]').val($oil_2_id);
          $('input[name=oil_1_num]').val($oil_1_num);
          $('input[name=oil_2_num]').val($oil_2_num);

          var old0_price  = $('#item_id_0').find("option:selected").attr("data-price");
          var old1_price  = $('#item_id_1').find("option:selected").attr("data-price");
          var old2_price  = $('#item_id_2').find("option:selected").attr("data-price");
          var old3_price  = $('#item_id_3').find("option:selected").attr("data-price");
          var old0_id = $('#item_price_0').attr('data-id');
          var old1_id = $('#item_price_1').attr('data-id');
          var old2_id = $('#item_price_2').attr('data-id');
          var old3_id = $('#item_price_3').attr('data-id');


          $("#item_price_0").val(old0_price);
          $("#item_price_1").val(old1_price);
          $("#item_price_2").val(old2_price);
          $("#item_price_3").val(old3_price);

          $("#CheckboxGroup0_res").val(old0_id);
          $("#CheckboxGroup1_res").val(old1_id);
          $("#CheckboxGroup2_res").val(old2_id);
          $("#CheckboxGroup3_res").val(old3_id);

          var price0 = $('option:selected').eq(0).attr('data-price');
          var price1 = $('option:selected').eq(1).attr('data-price');
          var price2 = $('option:selected').eq(2).attr('data-price');
          var price3 = $('option:selected').eq(3).attr('data-price');

		  amount = Number(price0)+Number(price1)+Number(price2)+Number(price3)+{$service_cost};

          $("#amount").text(amount);
        });

        $(".onlyfuwu").parent().click(function(){
          if($(this).find("img.onlyfuwu").attr("src")=="__PUBLIC__/mobile/images/gou3.png"){
            $("#CheckboxGroup0_res").val(0);
            $("#CheckboxGroup1_res").val(0);
            $("#CheckboxGroup2_res").val(0);
            $("#CheckboxGroup3_res").val(0);
            $("img.gou").attr("src","__PUBLIC__/mobile/images/gou3.png");
            $(this).find("img.onlyfuwu").attr("src","__PUBLIC__/mobile/images/gou2.png");
            $(".smenu2 div").removeClass("current");
            amount = {$service_cost};

            $("#amount").text(amount);

          }else{
            $(this).find("img.onlyfuwu").attr("src", "__PUBLIC__/mobile/images/gou3.png");
            $(".gou").attr("src", "__PUBLIC__/mobile/images/gou2.png");
            $(".smenu2 div:eq(1)").addClass("current");
            // var old0_price  = $('#item_price_0').val();
            // var old1_price  = $('#item_price_1').val();
            // var old2_price  = $('#item_price_2').val();
            // var old3_price  = $('#item_price_3').val();
            var old0_price  = $('#item_id_0').find("option:selected").attr("data-price");
            var old1_price  = $('#item_id_1').find("option:selected").attr("data-price");
            var old2_price  = $('#item_id_2').find("option:selected").attr("data-price");
            var old3_price  = $('#item_id_3').find("option:selected").attr("data-price");
            var old0_id = $('#item_price_0').attr('data-id');
            var old1_id = $('#item_price_1').attr('data-id');
            var old2_id = $('#item_price_2').attr('data-id');
            var old3_id = $('#item_price_3').attr('data-id');
            
            $("#CheckboxGroup0_res").val(old0_id);
            $("#CheckboxGroup1_res").val(old1_id);
            $("#CheckboxGroup2_res").val(old2_id);
            $("#CheckboxGroup3_res").val(old3_id);

            // amount = Number(old0_price) + Number(old1_price) + Number(old2_price) + Number(old3_price)+99;
			amount = Number(old0_price) + Number(old1_price) + Number(old2_price) + Number(old3_price)+{$service_cost};
            $("#amount").text(amount);
          }
          
        });


      $(".item_id").change(function(){
          var res = $(this).val();
          var _id = $(this).attr('id');
          var select_item = $(this).find('option:selected');
          var price = select_item.attr("data-price");
          var id = select_item.attr("id");

          _id = _id.split("_");
          _id = _id['2'];

          id = id.split("_");
          id = id['1'];

          if($(this).parent().parent().find(".gou").attr("src") == "__PUBLIC__/mobile/images/gou2.png"){
            if( $(this).attr('id') == 'item_id_0' ){
              //获得每样的数量
            var $oil_1_id = select_item.attr('data-oil-1-id'); 
            var $oil_1_num = select_item.attr('data-oil-1-num');
            var $oil_2_id = select_item.attr('data-oil-2-id');
            var $oil_2_num = select_item.attr('data-oil-2-num');
            $('input[name=oil_1_id]').val($oil_1_id);//放到要提交的数据框里面
            $('input[name=oil_2_id]').val($oil_2_id);
            $('input[name=oil_1_num]').val($oil_1_num);
            $('input[name=oil_2_num]').val($oil_2_num);
            }

            $("#CheckboxGroup"+_id+"_res").val(id);
            
            $(this).next().attr('data-id',id);

            old_price = $(this).next().val();
            console.log("old_price:%o", old_price);
            amount -= Number(old_price);
            if(amount < 0){
                amount = 0;
            }

              console.log("price:%o", price);
            $(this).next().val(price);
              console.log($(this).next().val());
            amount += Number(price);
              console.log("amount:%o", amount);

            $("#amount").text(amount);
              
          }else{
            if( $(this).attr('id') == 'item_id_0' ){
              //获得每样的数量
            var $oil_1_id = select_item.attr('data-oil-1-id'); 
            var $oil_1_num = select_item.attr('data-oil-1-num');
            var $oil_2_id = select_item.attr('data-oil-2-id');
            var $oil_2_num = select_item.attr('data-oil-2-num');
            $('input[name=oil_1_id]').val($oil_1_id);//放到要提交的数据框里面
            $('input[name=oil_2_id]').val($oil_2_id);
            $('input[name=oil_1_num]').val($oil_1_num);
            $('input[name=oil_2_num]').val($oil_2_num);
            }
            //console.log("price:%o", price);

            $("#CheckboxGroup"+_id+"_res").val(id);
            
            $(this).next().attr('data-id',id);

            old_price = $(this).next().val();
      
            $(this).next().val(price);

          }
      });

      $(".item_id option:eq(0)").change();


    });
    </script>
   <script type="text/javascript">
		document.write('<div style="display:none">');
		var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fd72ff4cb8351da14591b0a4299e1915c' type='text/javascript'%3E%3C/script%3E"));
		document.write('</div>');
	</script>
  </body>
</html>
